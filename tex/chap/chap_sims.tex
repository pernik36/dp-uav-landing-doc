\chapter{Simulátory bezpilotních letadel} \label{chap:sims}
    Simulace umožňuje zjednodušit vývoj nových algoritmů tím, že zvyšuje bezpečnost, snižuje režii a umožňuje rychlejší iteraci úprav a testování. V případě zkoumání vnějších vlivů na systém, jehož je algoritmus součástí, má umělé prostředí výhodu v tom, že jeho parametry jsou pod kontrolou vývojáře, který tak může systém testovat v širší škále podmínek a ověřit a zhodnotit tak jeho funkčnost i za podmínek (nebo jejich kombinace), které jsou v realitě v daném místě málo obvyklé. Rizikem je možná nepřesnost simulace, která způsobí odlišné chování systému při reálném nasazení, z toho důvodu je obvyklé simulační výsledky na konci vývoje validovat, jestli odpovídají realitě.

    Právě z důvodu minimalizace potřebných úprav a co nejsnazšího přenosu systému do reality je vhodné pro vývoj zvolit takový simulátor, který umožňuje propojení se skutečným letovým řídicím softwarem v řídicí jednotce letounu, jenž může být také simulovaný. V dokumentaci některých letových softwarů se simulaci přímo věnuje nějaká kapitola a nabízí různé podporované simulátory, které je možné spolu s nimi spustit \cite{px4:simulation}, \cite{ardupilot:simulation}, \cite{betaflight:simulation}.

    Mezi rozšířené řídicí softwary patří ArduPilot, Betaflight a PX4. Všechny podporují běh v simulovaném prostředí a spolupracují s vybranými simulátory. ArduPilot a PX4 se mimo jiné svou funkcionalitou zaměřují i na provádění autonomních misí, zatímco Betaflight je určen spíše pro lety s pohledem z první osoby například během závodění, kde je vyždována velmi rychlá a přesná odezva na vstupy z rádiového dálkového ovládání od pilota a poruchy způsobené například pohyby vzduchu v atmosféře. S různými zaměřeními souvisí i podporované způsoby ovládání, kdy ArduPilot a PX4 je možné řídit vzdáleně pomocí protokolu MAVLink i rádiově modelářským ovladačem, zatímco Betaflight přes MAVLink umí pouze vysílat telemetrii a s jiným než rádiovým ovládáním se příliš nepočítá. Podporované simulátory se mezi říicími softwary částečně překrývají, jejich přehled je uveden v \refskl{tab:sims}{tabulce}, zdrojem dat je oficiální dokumentace příslušného kontroléru \cite{px4:simulation}, \cite{ardupilot:simulation}, \cite{betaflight:simulation}.

    \begin{table}
        \centering
        \input{tab/tab_sims}
        \caption[Simulátory podporované kontrolérem letounu]{Přehled podpory často používaných simulátorů vybranými letovými řídicími souftwary.}
        \label{tab:sims}
    \end{table}

    Funkcemi se v \refskl{tab:sims}{tabulce} uvedené simulátory mohou výrazně lišit a pro další použití v této práci je třeba vybrat takový, ve kterém bude možné provozovat navádění na plošinu a to nejlépe na základě obrazu a simulovat různé vlivy prostředí. V následujících podkapitolách (\cref{sec:gazebo,sec:realflight,sec:jmavsim,sec:flightgear,sec:jsbsim,sec:airsim}) jsou zevrubně popsány hlavní funkce jednotlivých simulátorů a jejich obecný popis. Porovnání jejich vlastností důležitých pro tuto práci je uvedené v \refskl{tab:simsfeatures}{tabulce}.

    \begin{table}
        \centering
        \input{tab/tab_simsfeatures.tex}
        \caption[Vlastnosti vybraných simulátorů]{Podpora některých funkcí a vlastností, které jsou důležité pro návrh simulačního systému pro přistávání \acrshort{uav}, vybranými simulátory. \uv{ANO} znamená, že je daná funkce simulátorem zcela podporována; \uv{ČÁST.}, neboli částečně, je uvedeno u funkcí s omezenou podporou, jež nelze zcela použít, např. funkce implementovaná, která nemá žádný vliv na simulovaný model; \uv{NE} se uvádí u chybějící funkce simulátoru; \uv{-} vyznačuje funkci nepodporovanou z důvodu, že simulátor má jiné zaměření a nesplňuje podmínky pro implementací takové funkce; \uv{?} znamená to, že ze zdrojů dostupných autorovi nebylo možné spolehlivě určit, zda má simulátor danou funkcionalitu. Zkratky v tabulce: Def. prostředí znamená uživatelská definice prostředí, podm. jsou podmínky a dyn. znamená dynamické změny ostatních simulačních podmínek.}
        \label{tab:simsfeatures}
    \end{table}

    \section{Gazebo} \label{sec:gazebo}
        Gazebo je simulátor vyvíjený nadací Open Source Robotics Foundation. Je výchozím simulátorem v Robot Operating System, díky čemuž se těší velké oblibě při 3D simulacích dynamiky robotů. Má velmi aktivní komunitu. Umožňuje využití různých fyzikálních enginů, modelů senzorů a podporuje snadné vytváření 3D světů. Díky tomu lze snadno testovat návrhy robotů a algoritmů nebo i trénovat systémy strojového učení pomocí realistických scénářů. Gazebo používá modulární architekturu s oddělenými knihovnami pro simulaci fyziky, vykreslování, uživatelské rozhraní, komunikaci a generování dat senzorů. Podporované UAV zahrnují čtyřrotorové letouny (Iris a Solo), šestirotorové letouny (Typhoon H480), různé konvertoplány (např. letadla s plochou dráhou letu a svislým startem a přistáním), běžná letadla nebo pozemní vozítka. I když je Gazebo bohatou platformou, vykreslovací techniky nejsou tak pokročilé jako například v Unreal Engine nebo Unity, které využívají jiné simulátory. \cite{Ebeid2018}
    
        Co se týče simulace vnějších vlivů, Gazebo nativně umožňuje měnit podmínky osvětlení, simulaci větru je možné provést pomocí doplňku distribuovaného společně s Gazebem a v definici modelu je možné upravit, jak bude vítr působit na model. Teplotu i její senzor je možné také simulovat pluginem, ale působení na model není implementované. Ve starších verzích Gazeba označovné jako Gazebo classic je možné simulovat chování baterie pomocí pluginu \cite{batplugin}, ale změna dynamiky způsobená změnou vnitřního odporu baterie není ani s tímto pluginem přímočará.

    \section{RealFlight} \label{sec:realflight}
        RealFlight je komerční simulátor s 3D zobrazením, který umožňuje návrh a testování vlastních letounů. Podporuje simulaci různého počasí, včetně zhoršené viditelnosti, větru a změn podmínek osvětlení. Objekty v simulátoru také mohou vrhat stíny. Je zaměřen spíše na výcvik pilotů rádiem ovládaných modelů letadel a není možné ho spustit bez připojeného ovladače \cite{ardupilot:realflight}, \cite{realflight}. Kromě toho oficiální dokumentace nezmiňuje možnosti spouštění přímo s různými nastaveními vnějších vlivů \cite{realflight}, což by ztěžovalo vývoj, ani možnosti využití obrazových dat. Není tedy příliš vhodnou variantou pro použití v této práci. Narozdíl od Gazeba není podporován kontrolérem PX4.

    \section{jMAVSim} \label{sec:jmavsim}
        Java Micro Air Vehicle Simulator (jMAVSim) je jednoduchý a lehký simulátor multirotorových letounů vyvinutý týmem PIXHAWK engineering. Podporuje protokol MAVLink, používá knihovnu Java3D pro vizualizaci a připojuje se přímo k HIL pomocí sériového spojení nebo k Software-in-the-Loop (SITL) pomocí komunikace přes \acrfull{udp} k řídicímu softwaru PX4. Má jednoduchou monolitickou architekturu. \cite{Ebeid2018}

        Podporuje ho jediný z vybraných kontrolérů a to PX4. Zaměřuje se na simulaci dynamiky dronu, ale vyobrazení světa není příliš realistické, dokumentace nezmiňuje, jak měnit světelné podmínky a vytvářet stíny. Umožňuje umístění kamery na model a přenos obrazu přímo přes MAVLink, tímto způsobem může být přenos řešen i v reálném \acrshort{uav}, a umožňuje nastavení vlastností větru. \cite{jmavsim}, \cite{px4:jmavsim}

        Nemožnost simulace různých světelných podmínek, obtížná rozšiřitelnost a málo rozsáhlá dokumentace nejsou pro tuto práci vhodné.

    \section{FlightGear} \label{sec:flightgear}
        FlightGear je pokročilý open-source simulátor, který je snadno rozšiřitelný a má mnoho funkcí, které ho přibližují realitě. Simuluje polohu hlavních vesmírných těles (Slunce, Měsíc, planety sluneční soustavy a některé viditelné hvězdy) v závislosti na čase a poloze, je dodáván s modelem povrchu Země, který je rozšiřitelný o vlastní modely. Lze v něm simulovat počasí (vítr, srážky, změna osvětlení) a zobrazuje i stíny objektů. Podpora pro virtuální kameru umístěnou na modelu v dokumentaci není zmiňována. Má podporu pro různé modely dynamiky letounů včetně JSBSim (o tom dále v \refskl{sec:jsbsim}{sekci}). \cite{flightgear}

        Jako jediný z vybraných kontrolérů ho podporuje PX4. Kvůli obtížnému použití s kamerou a zbytečně mnoha funkcím, které by se musely nastavit, je jeho vhodnost pro použití v této práci omezená.

    \section{JSBSim} \label{sec:jsbsim}
        JSBSim je open source model letové dynamiky, který definuje pohyb letadla, rakety apod. pod vlivem sil a momentů, které na něj působí pomocí různých řídících mechanismů nebo přirozeně. JSBSim nemá vlastní grafiku. Může být spuštěn sám o sobě jako samostatný program, který bere vstup ze skriptovacího souboru a různých souborů konfigurace vozidel. Lze jej také začlenit do větší implementace leteckého simulátoru, který zahrnuje vizuální systém. Nejznámějšími příklady použití JSBSim jsou v současnosti simulátory FlightGear (open source), Outerra, BoozSimulator (open source) a OpenEaagles (open source). \cite{jsbsim}

        Tento model lze použít pro simulaci s kontroléry ArduPilot a PX4, které ho oba podporují. Přestože je možné pomocí JSBSim dobře modelovat dynamiku letounů, jeho samostatné využití pro simulaci přistání \acrshort{uav} by nebylo vhodné, kvůli absenci grafického prostředí a tím i kamery a dále obtížné přenositelnosti na reálný systém, protože simulace probíhá dávkově.

    \section{Airsim} \label{sec:airsim}
        Aerial Informatics and Robotics Platform (AirSim) byla vyvinuta společností Microsoft a klade si za cíl podporovat vývoj a testování algoritmů pro aplikace autonomních vozidel, jako jsou algoritmy hlubokého učení, počítačového vidění a algoritmy zpětnovazebního učení. Fyzikální engine AirSim je založen na Unreal Engine 4 a může pracovat s vysokou frekvencí pro simulace \acrshort{hil} v reálném čase s podporou populárních protokolů (např. MavLink). Simulátor odpovídá modulární architektuře s důrazem na rozšiřitelnost. \cite{Ebeid2018}

        Mezi její funkce, které by byly užitečné při návrhu systému pro simulaci přistávání, patří realistická grafika včetně zobrazování stínů, kterou je možno pozorovat pomocí virtuálních kamer implicitně umístěných na modelu, simulace atmosférických jevů, které ovlivňují viditelnost jako srážky, ve vzduchu rozptýlené prachové částice, mlha, a také různé světelné podmínky. Kromě toho má bohaté \acrshort{api} a všechny aspekty simulovaného světa je možné dynamicky upravit narozdíl například od Gazeba, kde je nutné tato nastavení předem určit v definičním souboru světa. \cite{airsim}

        Mezi podporované letové řídicí softwary patří u této simulační platformy stejně jako u JSBSim ArduPilot a PX4. AirSim je ve srovnání s ostatními zmíněnými simulátory mladším projektem a navíc měly být práce na ní v roce 2022 zastaveny kvůli plánovanému příchodu nového simulátoru od společnosti Microsoft, orientovaného na podnikatelskou sféru \cite{airsimweb}. Tyto skutečnosti by mohly vést k tomu, že by při vývoji systému pro přistávání navrženého v této práci nebylo možné řešit některé problémy, jež by vyvstaly, kvůli chybějící komunitě, nedostatku informačních zdrojů a přerušené oficiální podpoře.